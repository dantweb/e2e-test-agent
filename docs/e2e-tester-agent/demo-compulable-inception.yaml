payment-watch:
  environtment: dev
  url: https://oxideshop.dev
  timeout: 20
  jobs:
    - name: login
      prompt: Login to shop with username=${TEST_USERNAME} password=${TEST_PASSWORD}
      acceptance:
        - you are on the home page and see no errors
      on_error:
        try: username=$${TEST_USERNAME2} password=${TEST_PASSWORD2}
        catch: failed test

    - name: Shopping
      prompt: Add 2 products to cart
      acceptance: you see a popup and number 2 in the icon near the mini-cart

    - name: Add product to cart
      prompt: Add 5000 items of a random product to cart
      acceptance:
        - you see a popup and number 5002 in the icon near the mini-cart
      on_error:
        try: log error
        catch: continue

    - name: Checkout
      prompt:
        prompt_str: Open minibasket and click checkout
        expected_actions:
          - open minibasket
          - click checkout
        expected_action_sequence:
          - get minibasket node
          - click on it
          - get node, which is the checkout button
          - click on it
      acceptance:
        - you see the select payment method page

    - name: Select payment method
      prompt: Select payment method Google Pay
      on_error:
        try: select another payment method
        catch: failed test

    - name: Place order
      prompt:
        - Click place order and use username=${sitewatch.username} password=${sitewatch.password}
      acceptance:
        - you see "Thank you" on the page and an order number
        - watch:
            - table: oxorders
            - field: ordernr
            - assume: not empty
