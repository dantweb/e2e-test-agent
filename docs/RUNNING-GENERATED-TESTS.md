# Running Generated Tests

This guide explains how to run the `.spec.ts` test files generated by the E2E Test Agent.

## Quick Start

```bash
# Run all generated tests
npm run test:generated

# Run with visible browser (see tests in action)
npm run test:generated:headed

# Run with debug mode (step through tests)
npm run test:generated:debug

# Run specific test file
npx playwright test _generated/shopping-cart-test.spec.ts
```

---

## Understanding Generated Tests

When you run the E2E Test Agent, it generates two types of files:

1. **`.spec.ts`** - Playwright test files (TypeScript)
2. **`.ox.test`** - OXTest command files (custom format)

This guide focuses on running the **`.spec.ts`** files.

### Example Generated Test

```typescript
// _generated/shopping-cart-test.spec.ts
import { test, expect } from '@playwright/test';

test('shopping-cart-test', async ({ page }) => {
  await page.goto('https://osc2.oxid.shop');

  const shopLogo = page.locator('.logo');
  await expect(shopLogo).toBeVisible();

  // ... more test steps
});
```

---

## Methods to Run Generated Tests

### Method 1: Using npm Scripts (Recommended)

The easiest way to run generated tests:

```bash
# Run all tests in _generated directory (headless)
npm run test:generated

# Run with visible browser (see what's happening)
npm run test:generated:headed

# Run with step-by-step debugging
npm run test:generated:debug
```

**Advantages**:
- ✅ Simple commands
- ✅ Consistent with project scripts
- ✅ Works for all tests in `_generated/`

### Method 2: Using Playwright CLI Directly

For more control over test execution:

```bash
# Run all generated tests
npx playwright test _generated

# Run specific test file
npx playwright test _generated/shopping-cart-test.spec.ts

# Run with specific browser
npx playwright test _generated --project=chromium
npx playwright test _generated --project=firefox
npx playwright test _generated --project=webkit

# Run with headed browser (visible)
npx playwright test _generated --headed

# Run with debug mode (interactive)
npx playwright test _generated --debug

# Run with UI mode (interactive test runner)
npx playwright test _generated --ui

# Run with trace (for debugging failures)
npx playwright test _generated --trace on

# Run tests in parallel (default)
npx playwright test _generated --workers=4

# Run tests one at a time
npx playwright test _generated --workers=1

# Run only failed tests
npx playwright test _generated --last-failed
```

**Advantages**:
- ✅ Full Playwright CLI control
- ✅ Advanced options available
- ✅ Can target specific files/browsers

### Method 3: Re-generate and Execute (Full Workflow)

To regenerate tests from YAML and execute in one command:

```bash
# Full workflow: Parse YAML → Generate tests → Execute → Report
npm run e2e-test-agent -- \
  --src=tests/realworld/shopping-flow.yaml \
  --output=_generated \
  --execute \
  --reporter=html,console

# Docker version
docker run --rm \
  --user $(id -u):$(id -g) \
  --env-file .env \
  -v $(pwd):/workspace \
  e2e-test-agent:latest \
  --src=tests/realworld/shopping-flow.yaml \
  --output=_generated \
  --oxtest \
  --execute \
  --reporter=html
```

**Advantages**:
- ✅ Always uses latest YAML definitions
- ✅ Includes test generation
- ✅ Integrated reporting

**Disadvantages**:
- ❌ Slower (regenerates tests every time)
- ❌ Requires LLM API calls (costs money)

### Method 4: Using Playwright Test Runner UI

For interactive test development and debugging:

```bash
# Launch Playwright UI
npx playwright test _generated --ui
```

This opens an interactive UI where you can:
- ✅ Run tests one by one
- ✅ See test execution in real-time
- ✅ Inspect DOM and network requests
- ✅ Time-travel through test execution
- ✅ Edit and re-run tests

---

## Common Use Cases

### Use Case 1: Quick Verification

**Scenario**: You just generated tests and want to verify they work

```bash
# Run all generated tests in headless mode
npm run test:generated
```

**Expected Output**:
```
Running 1 test using 1 worker

  ✓  1 shopping-cart-test.spec.ts:3:1 › shopping-cart-test (15s)

  1 passed (16s)
```

### Use Case 2: Debugging Failed Tests

**Scenario**: A test failed and you want to see what went wrong

```bash
# Run with visible browser and slower execution
npm run test:generated:headed

# Or use debug mode for step-by-step execution
npm run test:generated:debug
```

**In Debug Mode**:
- Press "Step Over" (F10) to execute one line at a time
- Inspect variables and page state
- Use browser DevTools

### Use Case 3: Running Specific Test

**Scenario**: You only want to run one specific test file

```bash
# Run specific test
npx playwright test _generated/shopping-cart-test.spec.ts

# With headed browser
npx playwright test _generated/shopping-cart-test.spec.ts --headed

# With specific browser
npx playwright test _generated/shopping-cart-test.spec.ts --project=firefox
```

### Use Case 4: CI/CD Integration

**Scenario**: Running tests in GitHub Actions or other CI

```yaml
# .github/workflows/test.yml
- name: Run generated tests
  run: |
    npm run test:generated

- name: Upload test results
  if: always()
  uses: actions/upload-artifact@v4
  with:
    name: playwright-report
    path: playwright-report/
```

### Use Case 5: Cross-Browser Testing

**Scenario**: Test across multiple browsers

```bash
# Run on all browsers (Chromium, Firefox, WebKit)
npx playwright test _generated --project=chromium --project=firefox --project=webkit

# Or run separately
npx playwright test _generated --project=chromium
npx playwright test _generated --project=firefox
npx playwright test _generated --project=webkit
```

---

## Advanced Options

### Running with Trace

Traces help debug failures by recording everything:

```bash
# Record trace on failure
npx playwright test _generated --trace on-first-retry

# Record trace always
npx playwright test _generated --trace on

# View trace
npx playwright show-trace trace.zip
```

### Running with Screenshots

```bash
# Take screenshot on failure
npx playwright test _generated --screenshot=only-on-failure

# Take screenshots always
npx playwright test _generated --screenshot=on
```

### Running with Video

```bash
# Record video on failure
npx playwright test _generated --video=retain-on-failure

# Record video always
npx playwright test _generated --video=on
```

### Filtering Tests

```bash
# Run tests matching pattern
npx playwright test _generated --grep "shopping"

# Run tests NOT matching pattern
npx playwright test _generated --grep-invert "login"

# Run tests with specific tag
npx playwright test _generated --grep @smoke
```

### Timeout Configuration

```bash
# Set global timeout (default: 30s)
npx playwright test _generated --timeout=60000

# Set per-test timeout in test file
test('my test', async ({ page }) => {
  test.setTimeout(60000); // 60 seconds
  // ... test steps
});
```

---

## Playwright Configuration

The project includes a `playwright.config.ts` file. You can customize:

```typescript
// playwright.config.ts
export default defineConfig({
  testDir: './_generated',
  timeout: 30000,
  retries: 2,
  use: {
    headless: true,
    viewport: { width: 1280, height: 720 },
    screenshot: 'only-on-failure',
    video: 'retain-on-failure',
    trace: 'retain-on-failure',
  },
  projects: [
    { name: 'chromium', use: { ...devices['Desktop Chrome'] } },
    { name: 'firefox', use: { ...devices['Desktop Firefox'] } },
    { name: 'webkit', use: { ...devices['Desktop Safari'] } },
  ],
});
```

---

## Troubleshooting

### Issue 1: "Cannot find module '@playwright/test'"

**Solution**:
```bash
npm install
npx playwright install
```

### Issue 2: Browsers not installed

**Solution**:
```bash
npx playwright install chromium firefox webkit
```

### Issue 3: Test fails with timeout

**Solution**:
```bash
# Increase timeout
npx playwright test _generated --timeout=60000

# Or in test file
test.setTimeout(60000);
```

### Issue 4: Permission denied on _generated directory

**Solution**:
```bash
# Fix permissions
chmod -R 755 _generated
```

### Issue 5: Test fails intermittently

**Solution**:
```bash
# Enable retries
npx playwright test _generated --retries=2

# Or in playwright.config.ts
export default defineConfig({
  retries: 2,
});
```

---

## Best Practices

### 1. Always Review Generated Tests

Before running, review the generated `.spec.ts` files:

```bash
# View generated test
cat _generated/shopping-cart-test.spec.ts

# Or open in editor
code _generated/shopping-cart-test.spec.ts
```

### 2. Run in Headed Mode First

When testing new scenarios, run with visible browser:

```bash
npm run test:generated:headed
```

This helps you:
- Verify test behavior
- Spot timing issues
- Debug selector problems

### 3. Use Debug Mode for Failures

When a test fails:

```bash
npm run test:generated:debug
```

Step through the test to find the exact failure point.

### 4. Enable Traces for CI

In CI/CD, always enable traces:

```bash
npx playwright test _generated --trace on-first-retry
```

This helps debug failures that only happen in CI.

### 5. Keep Generated Tests Separate

Don't mix generated tests with hand-written tests:

```
tests/
  unit/           # Hand-written unit tests
  integration/    # Hand-written integration tests
  e2e/            # Hand-written E2E tests
_generated/       # Auto-generated tests (keep separate)
```

---

## Comparison: Methods

| Method | Speed | Control | Best For |
|--------|-------|---------|----------|
| `npm run test:generated` | ⚡⚡⚡ Fast | Low | Quick verification |
| `npx playwright test` | ⚡⚡⚡ Fast | High | Advanced usage |
| Re-generate + execute | ⚡ Slow | High | Always-fresh tests |
| Playwright UI | ⚡⚡ Medium | High | Debugging, development |

---

## Quick Reference

### Most Common Commands

```bash
# Run all generated tests (headless)
npm run test:generated

# Run with visible browser
npm run test:generated:headed

# Debug specific test
npx playwright test _generated/shopping-cart-test.spec.ts --debug

# Run on specific browser
npx playwright test _generated --project=firefox

# Run with trace (for debugging)
npx playwright test _generated --trace on

# Re-run only failed tests
npx playwright test _generated --last-failed

# View test report
npx playwright show-report
```

---

## Related Documentation

- **Playwright Docs**: https://playwright.dev/docs/running-tests
- **E2E Test Agent**: `README.md`
- **Docker Integration**: `docs/DOCKER-INTEGRATION-TEST.md`
- **Latest Updates**: `docs/LATEST-UPDATES-2025-11-17.md`

---

**Last Updated**: November 17, 2025
**Playwright Version**: Latest
**Node Version**: 20+
