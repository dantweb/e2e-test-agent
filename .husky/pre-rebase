#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Pre-rebase Hook - Prevent rebasing with uncommitted changes
# Also warns if rebase might conflict with security cleanup

echo "üîç Pre-rebase check..."

# Check for uncommitted changes
if ! git diff-index --quiet HEAD --; then
    echo "‚ùå ERROR: You have uncommitted changes."
    echo "   Please commit or stash your changes before rebasing."
    exit 1
fi

# Check if we're in the middle of a security cleanup
if [ -f "SECURITY-INCIDENT-*.md" ]; then
    echo "‚ö†Ô∏è  WARNING: Security incident report detected."
    echo "   If you recently cleaned git history, avoid rebasing."
    echo "   Consider using 'git push --force' instead."
    echo ""
    read -p "Continue with rebase? (y/n): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        echo "‚ùå Rebase aborted."
        exit 1
    fi
fi

echo "‚úÖ Pre-rebase checks passed."
